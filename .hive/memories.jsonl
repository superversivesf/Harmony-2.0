{"id":"mem-008f173d3bc6e3f7","information":"KokoroTtsEngine audio persistence fix: When persisting audio bytes to disk from a TTS engine: (1) Add OutputDirectory property to TtsConfig with sensible default like \"./output/audio\"; (2) Use lazy initialization to create directory only when needed; (3) Use File.WriteAllBytesAsync for async file I/O; (4) Generate unique filenames using segmentId + format extension; (5) Return the actual file path in AudioUrl instead of fake protocol URLs like \"audio://\". Key gotcha: Directory.CreateDirectory is synchronous but cheap - no need for async wrapper.","created_at":"2026-02-21T06:12:18.566Z","tags":"tts,audio-persistence,file-io,kokoro,dotnet"}
{"id":"mem-023e9673ce327fc3","information":"Model tests for Skaldforge use NUnit + AwesomeAssertions (FluentAssertions). Test patterns: [TestFixture], [Test], Should(). assertions. Model classes tested: Character, VoiceHints, VoiceAssignment, SynthesisJob, VoiceParameters, JobError. Tests cover construction, property validation, enums, voice mapping scenarios. Collections initialized with new() syntax. Required properties use 'required' keyword (C# 11+).","created_at":"2026-02-19T22:49:04.360Z","tags":"testing,nunit,awesomeassertions,models,skaldforge,dotnet10"}
{"id":"mem-033e2c073a6972f9","information":".NET modernization audit: Logger.cs and ChapterConvertor.cs successfully modernized. Key patterns applied: (1) Primary constructor syntax for simple initialization, (2) String interpolation with format specifiers ($\"{value:F0}\"), (3) Null-conditional operators for safe navigation (?. and ??), (4) Collection empty fallback pattern (?? []), (5) Changed public class to internal for visibility consistency. All 47 other warnings in project are from other files (AAXCtoM4BConvertor, AAXtoM4BConvertor, Program, FFProbeAnalyzer).","created_at":"2026-02-21T22:31:28.280Z","tags":"csharp,modernization,nullable-safety,string-interpolation,primary-constructor"}
{"id":"mem-03a2db51e6413b89","information":"Romcal calendar packages (@romcal/calendar.*) version 3.0.0-alpha.0 show peer dependency warnings \"incorrect peer dependency 'romcal@1.3.0'\" but they still function correctly. This is a known versioning issue with the alpha releases - the packages work with romcal 1.3.0 despite the warning. Do not downgrade romcal to resolve; the warning can be safely ignored during development.","created_at":"2026-02-20T20:10:52.756Z","tags":"romcal,dependencies,peer-dependency,liturgical-calendar,gotcha"}
{"id":"mem-03a3e9b4d25b2c1f","information":"EF Core case-insensitive search: Use EF.Functions.Like(column, $\"%{searchTerm}%\") instead of ToLower().ToLower() which prevents index usage. SQLite's LIKE is case-insensitive by default for ASCII characters. EF.Functions.Like works correctly with both SQLite and InMemoryDatabase for testing. Added indexes on searchable columns (Title, Description, ChannelName) to improve query performance.","created_at":"2026-02-17T22:09:51.610Z","tags":"ef-core,sqlite,case-insensitive,search,index"}
{"id":"mem-0490f35a7e0fa44c","information":"KokoroTtsEngine implementation: Maps ITtsEngine interface to KokoroClient API. Key patterns:\n1. Voice mapping: KokoroVoiceMapper.ToTtsVoice() converts Kokoro API voices to TtsVoice with language code parsing (af_heart → American Female)\n2. Batch synthesis: Uses SemaphoreSlim for concurrency control in parallel processing\n3. Voice caching: GetVoicesAsync caches voices locally to avoid repeated API calls\n4. Audio format mapping: MapAudioFormat/MapFromKokoroFormat handles format conversion between Skaldforge and Kokoro\n5. Voice ID parsing: Format is {lang}{gender}_{name} where lang codes are: a=American, b=British, e=Spanish, f=French, g=German, etc. Gender is m/f suffix.","created_at":"2026-02-21T05:08:58.949Z","tags":"kokoro,tts,implementation,voice-mapping"}
{"id":"mem-0663fc55d453aa55","information":"## Skaldforge Technical Debt Analysis (Feb 2026)\n\n**What:** Completed comprehensive codebase scan for technical debt markers.\n\n**Key Findings:**\n\n1. **Placeholder Code (3 files):**\n   - `src/Skaldforge.Tts/Class1.cs` - Empty placeholder\n   - `src/Skaldforge.Audio/Class1.cs` - Empty placeholder  \n   - `src/Skaldforge.Ai/Class1.cs` - Empty placeholder\n\n2. **Placeholder Test:**\n   - `tests/Skaldforge.Tests/UnitTest1.cs` - Empty test method with no assertions\n\n3. **Placeholder CLI:**\n   - `src/Skaldforge.Cli/Program.cs` - \"Hello World\" only, no commands implemented\n\n4. **Missing Implementations (6 interfaces defined but no services):**\n   - `IStoryParser` - No implementation exists\n   - `ICharacterAnalyzer` - No implementation exists\n   - `IVoiceMapper` - No implementation exists\n   - `ITtsEngine` - No implementation exists\n   - `IAudioStitcher` - No implementation exists\n   - `IManuscriptRepository` - No implementation exists\n\n5. **Missing CI/CD:**\n   - No `.github/workflows/` directory\n   - No build, test, or lint automation\n\n6. **TODO.md Status (467 lines):**\n   - Milestone 1: ~60% complete (models/interfaces done, implementations missing)\n   - Milestone 2: 0% complete (AI integration)\n   - Milestone 3: 0% complete (TTS/audio pipeline)\n   - Milestone 4: 0% complete (export/release)\n   - ~350+ tasks remain unchecked\n\n**No explicit HACK/FIXME comments found in source code.** The debt is primarily \"missing implementations\" rather than \"bad code that needs fixing.\"\n\n**Root Cause:** Project is early-stage with solid architecture (models, interfaces, config) but implementations not yet built.","created_at":"2026-02-19T18:35:16.923Z","tags":"skaldforge,technical-debt,analysis,codebase-status,missing-implementations"}
{"id":"mem-0898ddf5f29cb424","information":"When creating C# domain models for Skaldforge:\n\n1. Use nullable reference types (enabled in Directory.Build.props)\n2. Use `required` keyword for mandatory properties in models\n3. Enable `<GenerateDocumentationFile>true</GenerateDocumentationFile>` in .csproj for XML docs\n4. Use enum types for constrained string values (genre, emotion, voice pitch, etc.)\n5. JSON property names use snake_case (audio_settings) but C# properties use PascalCase - use [JsonPropertyName] attribute\n6. Project uses Central Package Management in Directory.Packages.props\n7. Code style rules are enforced: braces required for all control flow statements\n8. Models should match JSON schema in docs/TECHNICAL_SPECS.md exactly","created_at":"2026-02-19T10:16:11.673Z","tags":"csharp,dotnet,skaldforge,models,nullable,domain-models"}
{"id":"mem-0d30ed5ece763181","information":"CharacterHint pattern for Skaldforge: When implementing user-provided hints that override LLM-extracted values, use a separate CharacterHint model with nullable properties. Matching is done by ID first (case-insensitive), then by name. Only non-null hint properties are applied during merge. VoiceHints uses a separate VoiceHintOverrides class for the same pattern. The CharacterExtractionPrompt.FormatHintsForPrompt() helper formats hints for LLM prompt injection.","created_at":"2026-02-20T02:37:22.694Z","tags":"skaldforge,character-analyzer,hint-merging,LLM-override"}
{"id":"mem-19dad71a199f7ebb","information":"FFmpegStitcherTests TearDown fix: File/directory lock issue resolved by:\n1. Adding [NonParallelizable] attribute to test class to prevent concurrent test execution causing file locks\n2. Adding GC.Collect() + GC.WaitForPendingFinalizers() before cleanup to ensure disposed resources release file handles\n3. Adding retry logic (5 attempts, 100ms delay) for IOException and UnauthorizedAccessException in TearDown\n\nRoot cause: Tests running in parallel can cause temp directory cleanup races, and FFmpegWrapper disposal may not immediately release file handles.","created_at":"2026-02-21T07:50:22.793Z","tags":"testing,nunit,file-lock,cleanup,dispose"}
{"id":"mem-19e59d690b9d35ee","information":"Bug fix: _generateBookId() crashed on short book names (1-2 chars). Root cause: used original bookName.length for condition but operated on modified (cleaned) string after replaceAll(). Fix: assign cleaned string to variable first, then use its length for both condition and substring.","created_at":"2026-02-20T04:38:40.991Z","tags":"dart,bug-fix,substring-bounds,defensive-programming"}
{"id":"mem-1a7d8dfb2408e3bb","information":"Skaldforge TestRunner CLI created at src/Skaldforge.TestRunner. When using Spectre.Console tables, always escape user/exception content with Markup.Escape() to prevent parsing errors. HttpClient typed client DI requires Microsoft.Extensions.Http package. AudioPipeline requires VoiceAssignments when characters exist and VoiceMapper is null - provide default mappings or skip voice mapping.","created_at":"2026-02-21T06:31:22.520Z","tags":"skaldforge,cli,spectre-console,dependency-injection,httpclient,audio-pipeline"}
{"id":"mem-1fbae56d260848ed","information":"Skaldforge project assessment shows ~35% completion. StoryParser fully implemented with validation. Active blockers: CI/CD (B1), CLI commands (B2), placeholder projects (B5). Test infrastructure configured with NUnit + AwesomeAssertions. .NET 9 upgrade in progress.","created_at":"2026-02-19T21:39:55.917Z","tags":"skaldforge,assessment,project-status,blockers,tech-debt"}
{"id":"mem-225ac810925a6db7","information":"ProseParser implementation pattern: When parsing LLM JSON responses for Manuscript objects, parse characters first (needed for cross-reference validation), then scenes, then chapters. Use IdTracker class to generate sequential IDs (char_001, scene_001, chapter_001) and track existing IDs to avoid duplicates. Cross-reference validation should check: (1) dialogue speakerId → character id, (2) chapter scene references → scene ids, (3) orphaned scenes not referenced by any chapter. NarratorConfig only has VoiceId, VoiceHints, and Pace - no Name or Provider properties. AudioSettings.OutputFormat is an enum (AudioFormat), not a string.","created_at":"2026-02-20T03:28:02.674Z","tags":"csharp,parsing,json,manuscript,id-generation,validation,skaldforge"}
{"id":"mem-275ba2fbc96f4041","information":"Xabe.FFmpeg API patterns (v5.2.6):\n- Use `FFmpeg.Conversions.New()` (plural \"Conversions\") to create a conversion instance\n- `Start(arguments)` on IConversion returns `IConversionResult`, not bool\n- For progress: wire up `conversion.OnProgress += (sender, args) => { ... }` before calling Start\n- Use `Probe.New().Start(\"-version\")` for version info (not FFmpeg.GetFFmpegPathAsync which doesn't exist)\n- Set custom FFmpeg path via `FFmpeg.SetExecutablesPath(directoryPath)` before any operations\n- FFmpeg needs to be in PATH or SetExecutablesPath must be called - Xabe auto-discovers from PATH","created_at":"2026-02-21T07:26:32.600Z","tags":"xabe.ffmpeg,dotnet,audio,wrapper,api-patterns"}
{"id":"mem-27d66e9c04ae1e00","information":"DTO Modernization in Harmony-2.0: 1) AudibleVoucherDto MUST keep Newtonsoft.Json because AAXCtoM4BConvertor uses JsonConvert.DeserializeObject (line 63). 2) Files using System.Text.Json (AaxInfoDto, AudibleChaptersDto, AbsMetadata) can migrate from Newtonsoft.Json to System.Text.Json with JsonPropertyName attributes. 3) Class name conflict: AaxInfoDto and AudibleChaptersDto both defined 'Chapter' class with different structures - resolved by renaming to AaxChapter and keeping Chapter (both under Harmony.Dto namespace). 4) AudibleLibraryDto uses CsvHelper with convention-based mapping (property names match TSV headers) - keep camelCase property names, only add nullable annotations. 5) All consumer code uses PropertyNameCaseInsensitive=true with JsonSerializer so property names can be PascalCase with JsonPropertyName mapping.","created_at":"2026-02-21T22:27:59.130Z","tags":"dotnet,dto,serialization,modernization,harmony"}
{"id":"mem-28b3c70e516e87f4","information":"FFProbeAnalyzer.cs audit completed. File had naming issue (FFprobeAnalyzer → FFProbeAnalyzer), unused variable, redundant usings. Added ConfigureAwait(false) for async calls. CRITICAL: Found logic bug - Probe.New().Start() with malformed command string (trailing quote without opening quote), result was unused, method always returns true making validation meaningless. This needs manual review.","created_at":"2026-02-21T22:33:20.924Z","tags":"FFProbeAnalyzer,audit,modernization,async,bug-found"}
{"id":"mem-2c4b599523cbe489","information":"WHEN: Fixing duplicate provider definitions in Flutter Riverpod apps\nWHAT: Provider definitions should live in the repository file (not in multiple provider files) following clean architecture. Use `export` statements in provider files to re-export the provider for convenience.\nWHY: Multiple definitions of the same provider name cause provider resolution conflicts. The repository file is the canonical location since it defines the type being provided.\nPATTERN:\n1. Define provider in repository file: `final myRepositoryProvider = Provider<MyRepository>((ref) => MyRepository());`\n2. Re-export in provider files that need it: `export '../repositories/my_repository.dart' show myRepositoryProvider;`\n3. Remove duplicate definitions from provider files","created_at":"2026-02-20T05:18:09.832Z","tags":"flutter,riverpod,provider,duplicate,clean-architecture"}
{"id":"mem-2e2c580f044cd4aa","information":"TODO.md implementation checklist best practice: Include phase-based structure with checkboxes, detailed subtasks for each component, progress summary table, and future enhancements section. Use `[ ]` for incomplete items and `[x]` for complete items.","created_at":"2026-02-20T20:27:39.885Z","tags":"todo,checklist,implementation,typescript,bun"}
{"id":"mem-34e2733c1c6d95f2","information":".NET 9 upgrade package versions: Spectre.Console 0.50.0, NUnit 4.3.2, NUnit3TestAdapter 5.0.0, NUnit.Analyzers 4.6.0, coverlet.collector 6.0.2, AwesomeAssertions 8.0.2, NSubstitute 5.3.0, Microsoft.NET.Test.Sdk 17.13.0, Microsoft.Extensions.Configuration.* 9.0.2, System.Text.Json 9.0.2, JsonSchema.Net 7.3.4. Spectre.Console 0.49.2 does not exist - use 0.50.0 instead.","created_at":"2026-02-19T21:50:22.163Z","tags":"dotnet,nuget,upgrade,net9.0"}
{"id":"mem-35226c83e4791917","information":"FFmpeg command building patterns for C#:\n1. Path escaping: Single-quote wrap paths and escape internal single quotes with '\\'' for concat demuxer\n2. Filter graph paths need double-escape for backslashes and colons (\\ -> \\\\, : -> \\:)\n3. Concat demuxer uses file list format: \"file '/path/to/file'\" per line\n4. Loudness normalization uses loudnorm filter with I (integrated), TP (true peak), LRA (loudness range)\n5. Crossfade chain: for N inputs, chain acrossfade filters: [0:a][1:a]acrossfade...[a0];[a0][2:a]acrossfade...\n6. Two-pass normalization: measure with print_format=json, then apply with measured_I, measured_TP, measured_LRA, measured_thresh, offset\n7. M4B chapter format: FFmetadata with [CHAPTER] blocks, TIMEBASE=1/1000, START/END in milliseconds","created_at":"2026-02-21T07:34:18.860Z","tags":"ffmpeg audio c# stitching loudnorm crossfade m4b audiobook"}
{"id":"mem-35aec5fe80a714ca","information":"Centralized concurrency pattern in .NET: Create IConcurrencyManager interface with named SemaphoreSlim properties (DownloadSemaphore, SyncSemaphore). Register as singleton in DI. This consolidates throttling logic that was previously duplicated across services (DownloadService, VideoDownloadBackgroundService both had their own SemaphoreSlim with same config key). Benefits: consistent throttling, single source of truth, easier debugging, centralized configuration.","created_at":"2026-02-17T22:58:26.829Z","tags":"dotnet,concurrency,semaphore,di,singleton,throttling"}
{"id":"mem-38023619dd0c2d9f","information":"Architecture documentation best practice: Include ASCII diagrams for data flow visualization when Mermaid/draw.io isn't available in the target system. Multi-stage Docker builds reduce image size for Bun applications by ~50%. Romcal calendar loading pattern: use a record mapping diocese keys to imported calendar modules, with type guards for validation.","created_at":"2026-02-20T20:25:13.061Z","tags":"architecture,docker,romcal,bun,documentation"}
{"id":"mem-384ca73090336645","information":"Fixed test method name typo \"Disccovered\" → \"Discovered\" in VideoServiceTests.cs. Simple rename refactor, all tests pass after fix.","created_at":"2026-02-18T02:40:52.328Z","tags":"test,typo,rename,refactor"}
{"id":"mem-3a1d60b80446ccf9","information":"ToLower() should be replaced with ToLowerInvariant() for culture-agnostic lowercase string operations in .NET. This prevents the Turkish I problem and ensures consistent behavior across locales. Important: Do NOT change ToLower() calls in LINQ-to-Entities queries or EF.Functions - those need database-side translation and cannot use ToLowerInvariant().","created_at":"2026-02-18T02:43:49.523Z","tags":".NET,culture,invariant,ToLower,ToLowerInvariant,Turkish I problem"}
{"id":"mem-3e539510749d1df0","information":"Skaldforge test patterns: Use NUnit + FluentAssertions (AwesomeAssertions). Tests follow Arrange-Act-Assert pattern with [TestFixture] and [Test] attributes. Group related tests with #region blocks. Test both required properties and all properties. Test lookup methods (GetScene, GetCharacter, GetChapter) for found/not-found cases. Test hierarchy relationships between Manuscript-Chapters-Scenes-Characters-Dialogue. Use collection assertions like Should().HaveCount(), Should().Contain().","created_at":"2026-02-19T22:55:27.127Z","tags":"testing,nunit,fluent-assertions,dotnet,patterns"}
{"id":"mem-3f215d07643cd937","information":"## AppLogger Import Conflict Resolution Pattern\n\n**Problem:** When an app imports both `sancta_via_shared_ui` (which exports `AppLogger`) AND a local `utils/logger.dart` (which also defines `AppLogger`), Dart reports an ambiguous import error.\n\n**Solution:** Add `hide AppLogger` to the shared_ui import in files that need both:\n```dart\nimport 'package:sancta_via_shared_ui/sancta_via_shared_ui.dart' hide AppLogger;\nimport '../utils/logger.dart';\n```\n\n**Alternative:** If the local logger is the only one needed, use a prefix on the local import:\n```dart\nimport 'package:sancta_via_shared_ui/sancta_via_shared_ui.dart';\nimport '../../utils/logger.dart' as app_logger;\n// Use: app_logger.AppLogger.debug('message');\n```\n\n**Files commonly affected:**\n- `lib/main.dart` (imports both packages)\n- Provider files that use both shared_ui themes and local logging\n- Settings providers\n\n**API Difference:** \n- Shared UI: Instance-based (`AppLogger.bibleReading.debug()`)\n- Local: Static methods (`AppLogger.debug()`)\nThese APIs are incompatible - choose one pattern consistently per file.","created_at":"2026-02-21T05:23:46.508Z","tags":"flutter,import-conflict,AppLogger,sancta_via,shared_ui,dart"}
{"id":"mem-3f90111df0b0c2a8","information":"Three Makefiles had copy-paste bugs with incorrect APP_NAME variable. The sancta_via_prayer_companion had full package name instead of short name, while confession_companion and novena_companion both had 'bible_reading_app' from a copy-paste error. When copying Makefiles between apps, always update: APP_NAME variable, header comment, and all echo statements referencing the app name.","created_at":"2026-02-20T05:21:20.992Z","tags":"makefile,copy-paste-bug,build-config"}
{"id":"mem-42ab06f2b0c089bf","information":"Deleted video tracking implementation in Odeon: When users delete videos from the database, the system now tracks the YouTube Video ID and Channel ID in a DeletedVideos table. This prevents the sync process from re-importing videos the user explicitly deleted. Key implementation: 1) DeletedVideo entity with unique index on (ChannelId, VideoId), 2) VideoService.DeleteVideoAsync saves to DeletedVideos before removing the Video record, 3) VideoService.DiscoverVideosAsync filters out deleted video IDs when discovering new videos from yt-dlp.","created_at":"2026-02-20T20:44:51.754Z","tags":"odeon,ef-core,sync,deletion-tracking,video-management"}
{"id":"mem-4588043b6930477e","information":"Kokoro-FastAPI TTS integration for Skaldforge:\n- 66 voices in 10 languages, naming: {lang}{gender}_name (e.g., af_heart = American Female)\n- Main synthesis: POST /v1/audio/speech (OpenAI-compatible)\n- Captioned synthesis: POST /dev/captioned_speech (returns word timestamps)\n- Voice listing: GET /v1/audio/voices\n- Voice blending: \"af_bella(2)+af_heart(1)\" for weighted mixing\n- No auth required, sample rate 24000Hz\n- Formats: wav, mp3, opus, flac, pcm\n- Speed/pitch via speed and volume_multiplier params","created_at":"2026-02-21T04:50:46.725Z","tags":"kokoro,tts,audio,integration,api"}
{"id":"mem-466b7b2ac85ced79","information":"Skaldforge is a .NET 8 audiobook generation system using Kokoro TTS and Ollama AI. The codebase follows DDD with hexagonal architecture. Core library (Skaldforge.Core) is scaffolded with 13 domain models, 6 interfaces (ITtsEngine, IVoiceMapper, IStoryParser, IManuscriptRepository, IAudioStitcher, ICharacterAnalyzer), 8 config classes. Implementation libraries (Skaldforge.Tts, Skaldforge.Audio, Skaldforge.Ai, Skaldforge.Cli, Skaldforge.Tests) are empty placeholders. When implementing, start with Skaldforge.Core interfaces and work outward. Models are well-documented with XML comments.","created_at":"2026-02-19T18:32:10.254Z","tags":"skaldforge,dotnet,architecture,ddd,hexagonal,audiobook,tts"}
{"id":"mem-490431ad37225107","information":".NET Modernization Audit Pattern: When auditing C# files for .NET 10 modernization, safe auto-fixes include: (1) String interpolation replacing concatenation, (2) Pattern matching `is null`/`is not null` replacing `== null`/`!= null`, (3) Lowercase `string.Empty` per conventions, (4) Removing double semicolons, (5) Removing redundant newlines in WriteLine calls. High-priority manual review items: (1) Async/await patterns - `.Wait()` calls should be converted to `await`, (2) Null reference warnings CS8602/CS8604 from nullable reference types, (3) `.Result` on Task should use `await` instead.","created_at":"2026-02-21T22:47:30.427Z","tags":".net csharp modernization async csharp-audit"}
{"id":"mem-4c42b0bd9c8cb995","information":"FFmpegStitcher can accept FFmpegWrapper via constructor injection for DI scenarios. When doing so, added _ownsFFmpeg flag (default true) to control whether Dispose should also dispose the wrapper (false when injected). This pattern prevents premature disposal of shared resources.","created_at":"2026-02-21T10:05:56.342Z","tags":"dotnet,di,ffmpeg,dispose-pattern,skaldforge"}
{"id":"mem-4cac91f6fe140dbd","information":"Boolean logic bug pattern: Using || with \"not equals\" conditions creates a tautology that's always true. The pattern `if (x != A || x != B)` is ALWAYS true (every x is either not-A or not-B). Correct pattern is `if (x != A && x != B)` to check that x is neither A nor B. Found in prayer_detail_screen.dart where title visibility logic was broken.","created_at":"2026-02-20T05:13:44.247Z","tags":"boolean-logic,bug-pattern,dart,flutter"}
{"id":"mem-4cf77d417c664d7b","information":"CharacterParser pattern for LLM JSON parsing:\n- Use JsonDocument for parsing (not JsonSerializer) to handle malformed JSON gracefully\n- Extract JSON from markdown code blocks using regex: `@\"```(?:json)?\\s*\\n?(.*?)\\n?\\`\\`\\`\"`\n- Handle both wrapped {\"characters\": [...]} and direct [...] arrays\n- Use TryGetString with null checks to safely get string values from JsonElement\n- ParseEnum helper normalizes values (strips spaces, hyphens, underscores) before TryParse\n- Required fields (id, name) should be validated first; skip entire character if missing\n- Return tuple (List<Character>, List<string> Errors) to report partial success with errors","created_at":"2026-02-20T00:36:06.939Z","tags":"csharp,json-parsing,llm-response,enum-parsing,markdown-extraction"}
{"id":"mem-4e5199483367e305","information":"Catholic Bible OT/NT split: Old Testament has 46 books (orders 1-46), New Testament has 27 books (orders 47-73). The centralized helper functions `BibleBookMapping.isOldTestamentByOrder(int)` and `BibleBookMapping.isOldTestamentByIndex(int)` should be used instead of inline comparisons like `bookOrder <= 46` or `i < 46`. Deuterocanonical books (Tobit, Judith, 1-2 Maccabees, Wisdom, Sirach, Baruch) are orders 40-46 and are part of the Old Testament in Catholic canon.","created_at":"2026-02-20T05:04:26.228Z","tags":"bible,old-testament,new-testament,catholic,book-order,deuterocanonical"}
{"id":"mem-4eefa6c095fcce8e","information":"Flutter Riverpod Refactoring Pattern: Converting mutable StateNotifier to immutable state + Provider-based service.\n\nPROBLEM: StateNotifier<ApiClient> with mutable _baseUrl/_apiKey fields - Riverpod cannot detect state changes because object reference stays the same.\n\nSOLUTION (Approach 3 from advisory report):\n1. Create immutable state class (ApiConfig with final fields, copyWith, equality)\n2. Refactor service (ApiClient) to accept immutable state in constructor\n3. Create StateNotifierProvider for state (ApiConfigNotifier managing ApiConfig)\n4. Create Provider for service (watches state, creates service on state change)\n5. Update all dependent providers to import new provider file\n\nKEY FILES:\n- lib/models/api_config.dart (immutable state)\n- lib/services/api_client.dart (accepts config)\n- lib/providers/api_config_provider.dart (all providers)\n- lib/providers/auth_provider.dart (uses new providers)\n\nGOTCHA: Test files need updating - old constructor calls must use new config parameter.","created_at":"2026-02-17T04:26:25.423Z","tags":"Flutter,Riverpod,StateNotifier,immutable state,refactoring"}
{"id":"mem-50aef1832a55276b","information":"Odeon Backend Code Quality Review Findings: 1) PagedResult uses object instead of generic T, causing dynamic casting in tests - should be refactored to PagedResult<T>. 2) VideosController.cs contains multiple classes (PagedVideosResponse, DownloadResponse) violating one-class-per-file rule. 3) EF navigation properties use null-forgiving operator (null!) - consider nullable pattern instead. 4) Case-insensitive search uses ToLower() - prefer ToLowerInvariant() or EF.Functions.Like. 5) Test naming follows Method_Scenario_ExpectedResult pattern correctly. 6) FluentAssertions and Moq patterns are correctly implemented. 7) Structured logging uses property names correctly. 8) Exception handling uses specific types and preserves stack trace properly.","created_at":"2026-02-17T03:10:51.695Z","tags":"odeon,csharp,code-review,conventions,testing,fluentassertions,moq,nullable-reference-types"}
{"id":"mem-544c9e072bf2a2aa","information":"WHY: Code review flagged \"synchronous SaveChanges in VideoService\" but the code was already fixed.\n\nLEARNING: Always verify the actual code state before making changes. VideoService.cs already uses SaveChangesAsync() everywhere (lines 123, 261, 289, 367, 414). The test file (VideoServiceTests.cs) has 34 synchronous SaveChanges() in setup methods, which is acceptable in test setup but could be improved.","created_at":"2026-02-17T22:04:07.648Z","tags":"SaveChanges,async,VideoService,EF Core,false-positive"}
{"id":"mem-54b3d2a596870a78","information":"Created OllamaClient HTTP wrapper with pattern: inject HttpClient and AiConfig via constructor. Configure BaseAddress and Timeout from AiConfig. Use snake_case_lower JsonNamingPolicy for Ollama API. OllamaRequest/Response models for /api/generate. OllamaChatRequest/Response with OllamaMessage for /api/chat. OllamaException includes HttpStatusCode for error handling.","created_at":"2026-02-20T00:28:14.365Z","tags":"ollama,httpclient,api-wrapper,pattern"}
{"id":"mem-551799e8b32d306c","information":"tempus-bede is a liturgical calendar API using romcal with Bun runtime and Hono framework. Supports 6 dioceses (united-states, england, italy, france, spain, germany). REST endpoints: GET / (API info), GET /today, GET /date/:date, GET /health. Uses calendar caching for performance. Multi-stage Dockerfile with health check. TypeScript with strict typing for LiturgicalDayResponse and ErrorResponse interfaces.","created_at":"2026-02-20T20:53:48.115Z","tags":"tempus-bede,romcal,liturgical-calendar,bun,hono,api,documentation"}
{"id":"mem-5a07cb8f9bf45a91","information":"Flutter stream subscriptions returned from `.listen()` must be stored in instance variables and cancelled in dispose() to prevent memory leaks. Always track StreamSubscription<T>? references and call .cancel() before setting to null. The pattern: `_subscription = stream.listen(callback)` then `await _subscription?.cancel(); _subscription = null;` in dispose. This prevents events firing after widget disposal and avoids memory leaks.","created_at":"2026-02-17T22:15:38.418Z","tags":"flutter,dart,stream,dispose,memory-leak,riverpod,statenotifier"}
{"id":"mem-5d355809d80dade2","information":"Created generic PagedResult<T> class in Odeon.Core/DTOs/ with pagination metadata. Uses ICollection<T> for Items, calculated properties PageNumber/TotalPages/HasPreviousPage/HasNextPage. Factory methods: Empty() and Create(). File naming convention: PagedResult{T}.cs for generic types.","created_at":"2026-02-17T08:42:58.675Z","tags":"dotnet,dto,pagination,generic,odeon"}
{"id":"mem-608e83478b3dea07","information":"ODEON Backend Architecture Review Findings (2026-02-17): .NET 10 Clean Architecture implementation. GOOD overall compliance. Layering: Core (domain/interfaces) → Infrastructure (services/DbContext) → Api (controllers) → BackgroundJobs. DI lifetimes: Singleton for IYtDlpService (stateless), IDownloadQueue (state); Scoped for IChannelService, IVideoService, ISyncService, IDownloadService (DbContext consumers). Issues found: 1) VideoListItemDto in Infrastructure/Services violates layer - should be in Core/DTOs, 2) VideoService.cs:160-162 sync SaveChanges() in progress callback, 3) Channel entity missing data annotations. AGENTS.md compliance: High - file-scoped namespaces, naming conventions, nullable enabled, async EF Core, constructor DI only, structured logging.","created_at":"2026-02-17T03:00:52.583Z","tags":".NET,clean-architecture,dependency-injection,architecture-review,Odeon"}
{"id":"mem-61304cac9a3cf44f","information":"CharacterAnalyzer tests use NSubstitute for mocking IOllamaClient. Key patterns: Use Arg.Any<T>() for loosely-typed mocks, Arg.Do<T>() to capture arguments for assertions. For async exceptions, use Returns(Task.FromException<T>(exception)) instead of ThrowsAsync which doesn't exist for Task<T>. CharacterParser expects {\"characters\": [...]} wrapper - direct arrays at root cause InvalidOperationException. IOllamaClient.GenerateAsync returns Task<OllamaResponse> with a Response string property containing JSON.","created_at":"2026-02-20T01:18:29.652Z","tags":"testing,NSubstitute,mocking,CharacterAnalyzer,dotnet,NUnit"}
{"id":"mem-61d55e69c2f3b5f4","information":"AudioPipeline tests require using a custom SynchronousProgress&lt;T&gt; class instead of Progress&lt;T&gt; for unit tests. The built-in Progress&lt;T&gt; uses SynchronizationContext which may not capture callbacks properly in async unit tests, leading to flaky tests where progress reports appear empty. Creating a simple IProgress&lt;T&gt; implementation that invokes the callback synchronously solves this issue.","created_at":"2026-02-21T05:57:42.295Z","tags":"testing,c#,unit-testing,async,progress-reporting"}
{"id":"mem-646ba0c641a71f7e","information":"## ProseConverter Orchestration Pattern\n\nWhen implementing orchestration services in Skaldforge:\n\n1. **Interface Pattern**: Define interface in `Skaldforge.Core/Interfaces` with result classes\n   - Include `Success`, `HasErrors`, `HasWarnings` boolean properties\n   - Return `ProseConversionResult` with `Manuscript?` and error/warning lists\n\n2. **Service Implementation**: Create service in `Skaldforge.Ai/Services`\n   - Inject `IOllamaClient` interface (not concrete class)\n   - Use static methods from prompt classes (e.g., `ProseAnalysisPrompt.CreateUserPrompt`)\n   - Temperature 0.3 from `RecommendedTemperature` constant for deterministic output\n   - Instantiate parser in constructor: `new ProseParser()`\n\n3. **Error Handling Layers**:\n   - Input validation (null/empty checks)\n   - OllamaException for LLM API errors\n   - HttpRequestException for network issues\n   - OperationCanceledException for cancellation\n   - General Exception catch-all\n\n4. **Statistics Pattern**: Use `Stopwatch.StartNew()` and `BuildStatistics()` helper method","created_at":"2026-02-20T03:32:31.630Z","tags":"skaldforge,orchestration,pattern,prose-converter,ollama,ai-services"}
{"id":"mem-6b83fc2a75a24e12","information":"Romcal 1.3.0 uses calendarFor() API with country names in camelCase (e.g., 'unitedStates', 'england'). The @romcal/calendar.* packages at 3.0.0-alpha.0 expect romcal 3.0.0-alpha.0 but work with 1.3.0's built-in calendars. Romcal generates dates as ISO strings in moment field. Romcal has no TypeScript types, so we created src/types/romcal.d.ts with declarations. Calendar caching with Map<string, Map<string, RomcalDay>> pattern works well for O(1) lookup.","created_at":"2026-02-20T20:38:37.694Z","tags":"romcal,typescript,liturgical-calendar,caching"}
{"id":"mem-70ed315c2860a133","information":"Odeon Flutter Frontend Structure: Complete inventory of 25 Dart files across 5 modules. Uses Riverpod for state management (StateNotifierProvider pattern), go_router for navigation with auth guards, media_kit for video playback. Key modules: 6 screens (home, login, video_detail, channels, settings, episodes), 2 widgets (video_card, channel_card), 5 providers (auth, videos, channels, api_config, video_player), 5 services (api_client 503 lines, auth_service, notification_service, background_polling_service, playback_position_service), 6 models. All implementations complete. Only TODO found: channel_card.dart:46 for navigating to channel videos. Architecture follows clean separation: Models → Services → Providers → Screens → Widgets.","created_at":"2026-02-20T09:01:02.245Z","tags":"flutter,mobile,riverpod,odeon,frontend,inventory,discovery"}
{"id":"mem-75e72b4d551c5d9e","information":"Skaldforge build configuration setup: Directory.Build.props includes net8.0 target, nullable enabled, implicit usings, warnings as errors, version 0.1.0, MIT license, and CI/CD support. Directory.Packages.props uses central package management with Spectre.Console 0.49.1, xunit 2.9.2, FluentAssertions 6.12.0, NSubstitute 5.1.0, Microsoft.Extensions.Configuration 8.0.x, System.Text.Json 8.0.5, and JsonSchema.Net 7.3.0. .editorconfig enforces 4-space indents, LF line endings, final newline, unused using removal, using sorting, and comprehensive C# naming conventions with underscore-prefixed private fields.","created_at":"2026-02-19T10:08:27.367Z","tags":"build-configuration,dotnet,csharp,editorconfig,central-package-management"}
{"id":"mem-78234e291da31a29","information":"Skaldforge project planning completed successfully. Decomposed into 6 documentation tasks: PROJECT_CHARTER (vision/goals), ARCHITECTURE (system design with Mermaid diagrams), TECHNICAL_SPECS (JSON schema, APIs, C# structure), MILESTONES (8-week timeline), TODO (350+ checklists), README (entry point). Feature-based decomposition worked well for documentation tasks. Workers completed in parallel where dependencies allowed.","created_at":"2026-02-19T09:39:13.035Z","tags":"coordinator,decomposition,documentation,skaldforge,planning,feature-based-strategy"}
{"id":"mem-78e1806f2efcadc0","information":"When writing tests with AwesomeAssertions (FluentAssertions fork), use `BeGreaterThanOrEqualTo` not `BeGreaterOrEqualTo`. When verifying async calls with NSubstitute's Received(), use `await` with the Received() call for async methods.","created_at":"2026-02-20T03:38:31.116Z","tags":"testing,nunit,awesomeassertions,nsubstitute"}
{"id":"mem-803135e2f957b0c9","information":"Skaldforge project has comprehensive planning documentation:\n\n**Planning Documents Found:**\n- `docs/TODO.md` - Granular task checklist with 467 lines, tracking all 4 milestones\n- `docs/MILESTONES.md` - 8-week timeline with 4 milestones, dependency graph, risk mitigation\n- `docs/TECHNICAL_SPECS.md` - Full JSON schema, API endpoints, CLI commands, C# project structure\n- `docs/ARCHITECTURE.md` - System design, data flow diagrams, tech stack decisions, integration points\n- `docs/PROJECT_CHARTER.md` - Vision, goals, MVP scope, success criteria\n\n**Key Planned Features (MVP):**\n1. JSON manuscript parser with validation\n2. AI-powered character voice analysis (via Ollama)\n3. Voice-to-character mapping with human approval workflow\n4. Kokoro TTS integration for synthesis\n5. Audio stitching and export (MP3/M4B)\n6. Terminal UI (Spectre.Console)\n\n**Phase 2+ Roadmap:**\n- Music Engine (ComfyUI integration)\n- Sound Effects (scene-based SFX)\n- Real-time Preview\n- Multi-project Support\n- Web UI (Blazor)\n- Cloud Deployment\n- Voice Cloning\n- Collaboration Features\n\n**Current Implementation Status:**\n- Core models exist (Manuscript, Character, Scene, DialogueLine, etc.)\n- Configuration classes complete\n- Interfaces defined (IStoryParser, IVoiceMapper, ITtsEngine, etc.)\n- Minimal implementation code (placeholder classes in Tts/Audio/Ai projects)\n\n**TODO Categories:**\n- M1 (Weeks 1-2): Project setup, CI/CD, Core Models, JSON Parser, CLI skeleton, Config system\n- M2 (Weeks 3-4): Ollama client, Character Analyzer, Voice Mapper, TUI approval workflow\n- M3 (Weeks 5-6): Kokoro TTS client, Synthesis engine, Audio pipeline, Cache system\n- M4 (Weeks 7-8): Audio stitching, Export (MP3/M4B/WAV/FLAC), E2E testing, Documentation","created_at":"2026-02-19T18:17:20.358Z","tags":"skaldforge,planning,roadmap,milestones,architecture,documentation"}
{"id":"mem-812b9e91261be940","information":"Skaldforge test patterns: Use NUnit + FluentAssertions (AwesomeAssertions package). Follow existing ModelTests.cs pattern with region-based organization. Tests use `// Arrange & Act` comments and FluentAssertions `.Should()` syntax. Configuration classes have sensible defaults that need testing. Pre-existing errors: Genre.SciFi (not Scifi), NarratorPace (not SpeakingPace for NarratorConfig).","created_at":"2026-02-19T23:03:48.883Z","tags":"testing,nunit,fluentassertions,skaldforge,c#"}
{"id":"mem-81d6fbd24b09d09e","information":"## Odeon .NET Backend Architecture Discovered\n\n### Key Findings:\n1. **API Endpoints**: 4 controllers (Videos, Channels, Sync, Health) with 12+ endpoints\n2. **Download Stack**: yt-dlp + FFmpeg auto-transcode to H.264/AAC\n3. **Missing Features**: No playlist support, no quality selection, no subtitles\n4. **Background Services**: ChannelSyncBackgroundService (60min interval), VideoDownloadBackgroundService (concurrent)\n5. **Security**: API key auth, rate limiting, path traversal prevention\n\n### Key Files:\n- YtDlpService.cs (645 lines) - Core download logic, format string configurable\n- DownloadService.cs (416 lines) - Auto-transcode via FFmpeg\n- VideosController.cs (469 lines) - Main API endpoints\n\n### Database:\n- Channel 1:N Video with cascade delete\n- Entities: Video, Channel, ApiKey\n\n### Why This Matters:\nAdding playlist support would require new endpoints, new entity relationships, and download batch processing. Quality selection requires API changes to DownloadVideoRequest and YtDlpService.","created_at":"2026-02-20T09:05:49.662Z","tags":"odeon,backend,.NET,yt-dlp,architecture,discovery"}
{"id":"mem-8687d3f7e6d10357","information":"Flutter API client patterns in Odeon:\n- Models use `fromJson` factory constructor and `toJson()` method\n- Enums use `fromString`/`toApiString` pattern and switch expressions\n- Enums use string values for API serialization (not ints like VideoStatus)\n- API methods either use `_handleRequest<T>` for typed responses or direct HTTP calls for list endpoints\n- Void operations use `_handleVoidRequest` helper\n- Paged responses include: items list, totalCount, page, limit, hasMore fields","created_at":"2026-02-20T09:11:09.893Z","tags":"flutter,dart,api-client,models,patterns"}
{"id":"mem-86b646be351b6148","information":"FFmpegStitcher testing approach: Use minimal valid WAV file headers (44 bytes + audio data) for integration tests that need actual audio files. This avoids dependency on external audio files and creates self-contained tests. The WAV header format: RIFF header + fmt chunk (16 bytes) + data chunk with sample data. Unit tests for FFmpegCommands focus on string output verification (no FFmpeg needed). FFmpegWrapper tests stub file operations but require actual FFmpeg for ExecuteAsync tests (use Assert.Ignore for missing FFmpeg).","created_at":"2026-02-21T07:45:25.584Z","tags":"testing,ffmpeg,audio,wav-header,unit-tests"}
{"id":"mem-8746fd786d09be92","information":"sancta_via_shared_ui package analysis completed. Main issues: 1) No tests (critical), 2) Missing analysis_options.yaml (high), 3) Duplicated liturgical color definitions between app_theme.dart and liturgical_color_extensions.dart (high), 4) _getLanguageFlag method duplicated 3 times in language_selector.dart (high), 5) Path dependency prevents pub.dev publishing (high), 6) Silent exception handling in 8 catch blocks (medium), 7) Deprecated RadioListTile groupValue/onChanged properties (medium), 8) Deprecated withOpacity() usage in 5 files (medium). Positives: Clean architecture, good immutability patterns, excellent documentation, Material 3 design.","created_at":"2026-02-20T03:48:32.346Z","tags":"sancta_via_shared_ui,analysis,code-quality,flutter,dart"}
{"id":"mem-885121f185e890a6","information":"FFmpeg concat demuxer requires single quotes in file paths to be escaped. If a path contains a single quote (e.g., \"O'Brien's chapter.wav\"), the concat file line must be written as: `file 'path with '\\'' escaped quote'`. The pattern `'\\''` means: end the string, add an escaped literal single quote, start a new string. In C#: `path.Replace(\"'\", \"'\\\\''\")`. This is already correctly handled in `FFmpegCommands.EscapePath()` and `FFmpegStitcher.WriteConcatFileAsync()`, but was missing in `FFmpegStitcher.ExportAsync()` when building the concat file content directly.","created_at":"2026-02-21T10:37:08.875Z","tags":"ffmpeg,concat-demuxer,path-escaping,single-quote"}
{"id":"mem-8b0db721c11c4cdc","information":"Created multi-stage Docker configuration for tempus-bede Bun application. Uses oven/bun:1-alpine base image with non-root user for security. Healthcheck uses wget spider mode for efficiency. The build stage separates dependencies installation from source copy for layer caching optimization.","created_at":"2026-02-20T20:40:10.266Z","tags":"docker,bun,deployment,alpine,multi-stage"}
{"id":"mem-8bc786cf3b856c3a","information":"Spectre.Console Markup.Escape() tests: The method correctly escapes square brackets by doubling them ([ -> [[, ] -> ]]). Edge cases tested: empty string, no brackets (passthrough), single brackets, nested brackets, newlines/tabs preserved, Unicode/emoji preserved, null throws ArgumentNullException. Important: double-escaping is NOT idempotent - escaped strings get escaped again. Use Markup.Escape() once on any dynamic text before passing to AnsiConsole.MarkupLine().","created_at":"2026-02-21T10:28:25.668Z","tags":"spectre-console,testing,markup-escaping,csharp"}
{"id":"mem-8c1277d8b39b62c5","information":"Added analysis_options.yaml to missing Flutter packages in monorepo. Standard template includes flutter_lints with rules: implicit-casts/dynamic false, prefer_single_quotes, require_trailing_commas, sort_pub_dependencies. For packages using 'lints' instead of 'flutter_lints', update pubspec.yaml to use flutter_lints for consistency.","created_at":"2026-02-20T08:54:52.449Z","tags":"flutter,linting,analysis_options,monorepo"}
{"id":"mem-8d3bab91ff0aa800","information":"Flutter monorepo build verification: All 5 apps (bible_reading_app, confession_companion, liturgical_calendar_app, novena_companion, prayer_companion) use pubspec_overrides.yaml for local path dependencies. Run `flutter pub get` and `flutter analyze --no-pub` per app - not `flutter build apk` which is too slow for verification. All apps have only info/warning lint issues, no compilation errors.","created_at":"2026-02-21T05:27:43.756Z","tags":"flutter,build,verification,monorepo,sancta_via"}
{"id":"mem-8e4c02a979ddbd3e","information":"ChannelSyncBackgroundService already uses Parallel.ForEachAsync with IConcurrencyManager.MaxSyncParallelism for parallel channel synchronization. The implementation creates a new scope per channel for thread-safe DbContext usage and properly handles cancellation tokens. Testing Parallel.ForEachAsync behavior requires focused tests that verify the parallelism controls rather than mocking the entire service provider chain.","created_at":"2026-02-17T23:18:12.669Z","tags":"parallel foreach async sync background service concurrency"}
{"id":"mem-91c76e9ac273deb5","information":"TextChunker implementation: Use Regex with Compiled | IgnoreCase | Multiline options for chapter/scene break pattern matching. Word counting via Split with RemoveEmptyEntries for efficiency. When handling text boundaries, be careful with \\r\\n vs \\n handling across platforms.","created_at":"2026-02-20T05:20:18.718Z","tags":"text-chunking,regex,csharp,prose-processing"}
{"id":"mem-938aab216a65db73","information":"Flutter DropdownMenu is the Material 3 replacement for DropdownButtonFormField. The `value` property is deprecated in favor of `initialSelection`. Use DropdownMenu<T> with dropdownMenuEntries (list of DropdownMenuEntry) instead of items (list of DropdownMenuItem). Leading icon uses leadingIcon instead of decoration.prefixIcon. The inputDecorationTheme can be applied for border styling.","created_at":"2026-02-20T19:58:12.851Z","tags":"flutter,material3,dropdown,deprecation"}
{"id":"mem-951810c36c9c1d3e","information":"## Flutter AppLogger Import Conflict Resolution\n\n**Problem:** When a Flutter app has a local `utils/logger.dart` exporting `AppLogger` AND imports a shared package (`sancta_via_shared_ui`) that also exports `AppLogger`, Dart reports an ambiguous import error: \"The name 'AppLogger' is defined in the libraries 'package:sancta_via_shared_ui/...' and 'package:my_app/utils/logger.dart'\".\n\n**Root Cause:** Two libraries export the same symbol, creating ambiguity at import sites.\n\n**Solution:**\n1. Keep the local logger.dart as the canonical source (self-contained)\n2. Add `hide AppLogger` to the shared_ui import in consuming files:\n   ```dart\n   import 'package:sancta_via_shared_ui/sancta_via_shared_ui.dart' hide AppLogger;\n   import 'utils/logger.dart';\n   ```\n\n**Alternative:** Remove local logger.dart entirely and re-export from shared_ui with app-specific prefix, but this creates more coupling.\n\n**Affected Files Pattern:** Any file that imports both the shared_ui package AND uses AppLogger needs the `hide AppLogger` clause.\n\n**Verification:** Run `flutter analyze --no-pub` after fixes to confirm no ambiguous import errors.","created_at":"2026-02-21T05:28:50.454Z","tags":"flutter,dart,import-conflict,applogger,shared-ui,monorepo"}
{"id":"mem-9a56d60e36a03af6","information":"Skaldforge configuration classes created in src/Skaldforge.Core/Configuration/ with nullable reference types, XML documentation, and sensible defaults. Uses central package management (Directory.Packages.props). Projects require GenerateDocumentationFile=true in project file to enable IDE0005 enforcement. The existing AudioFormat enum in Models/AudioSettings.cs differs from AudioOutputFormat in Configuration/AudioConfig.cs - both serve different purposes.","created_at":"2026-02-19T10:39:23.596Z","tags":"skaldforge,configuration,csharp,dotnet"}
{"id":"mem-9b02b0358c74612a","information":"FFmpeg concat demuxer requires specific file format: each line must be `file '/path/to/audio.wav'` with single quotes around the path. If paths contain single quotes (e.g., \"O'Brien's Chapter.wav\"), they must be escaped as `'\\''` (end quote, escaped literal quote, start quote). In Skaldforge, there were two code paths generating concat files - one had escaping (WriteConcatFileAsync) and one didn't (ExportAsync). Always check ALL code paths when fixing escaping bugs.","created_at":"2026-02-21T10:42:04.992Z","tags":"ffmpeg,concat,escaping,bug-fix"}
{"id":"mem-9e48d4a27518b294","information":"## Skaldforge Project Architecture\n\n**What:** This is a .NET 8.0 C# audiobook production platform, NOT a Node.js project. There is no package.json - use Directory.Build.props and Directory.Packages.props for build configuration.\n\n**Key Architecture:**\n- 6-project solution: Core (models/interfaces), Cli (Spectre.Console), Ai (Ollama), Tts (Kokoro), Audio (FFmpeg), Tests\n- Core defines all interfaces: IStoryParser, ICharacterAnalyzer, IVoiceMapper, ITtsEngine, IAudioStitcher\n- Domain models: Manuscript → Chapter → Scene → DialogueLine with Character voice assignments\n- SynthesisJob tracks audio generation pipeline progress\n- Configuration in Skaldforge.Core/Configuration/ with default values\n\n**Development Status (as of Feb 2026):**\n- Milestone 1 ~60% complete: models/interfaces done, implementations NOT done\n- CLI is a placeholder \"Hello World\", needs command implementations\n- TTS/AI/Audio projects have no implementations, just Class1.cs placeholder\n- Tests project has only empty test file\n\n**Important Files:**\n- schemas/manuscript.schema.json - JSON schema for manuscripts\n- samples/sample-manuscript.json - Example manuscript\n- docs/TODO.md - Detailed progress tracking (467 lines of tasks)","created_at":"2026-02-19T18:22:45.236Z","tags":"dotnet,csharp,architecture,skaldforge,project-structure"}
{"id":"mem-9f552334f707d7c3","information":"Program.cs modernization: Applied naming convention fixes (camelCase to PascalCase for Options class properties), fixed redundant ToString() call, used object initializer for CsvConfiguration, fixed redundant null assignment, fixed doc typo (MP3 to M4B). Top-level statements deferred as it requires moving Options class to separate file or making it file-scoped. Async Main and modern CLI patterns deferred. LoopMode implementation bug noted (Thread.Sleep(600) is 0.6 seconds not 5 minutes).","created_at":"2026-02-21T22:36:56.897Z","tags":".NET modernization,Program.cs,naming conventions,C# style"}
{"id":"mem-a2ec7f1e6e619249","information":"Code review synthesis: SWARM_CODE_REVIEW.md created consolidating 28 findings (1 critical, 12 high, 12 medium, 3 low) from 6 worker agents. Key issues: mutable StateNotifier (critical), HTTP URLs exposing API keys, memory leaks in Flutter providers, BCrypt verification on every request, non-generic PagedResult. Report organized by severity with actionable recommendations and prioritized remediation roadmap.","created_at":"2026-02-17T03:19:20.958Z","tags":"code-review,synthesis,swarm-findings,architecture,security,performance"}
{"id":"mem-af622f0c9a041837","information":"**.NET Target Framework Selection Gotcha:** When setting TargetFramework in .csproj files, check what runtimes are available on the target machine. A build may succeed even if the runtime isn't installed, but tests will fail at execution time. Also discovered that projects using Directory.Build.props for central configuration may need scope clarification - the TargetFramework can be set either centrally (preferred) or in individual project files (override pattern).","created_at":"2026-02-19T21:45:30.166Z","tags":"dotnet,target-framework,csproj,directory.build.props"}
{"id":"mem-b4ff88c3186a1f6c","information":"## FFmpeg Temp File Race Condition Bug\n\n**Root Cause:** Silence cache returns cached file paths that are then added to tempFiles and deleted by the finally block, causing stale cache entries.\n\n**Bug Pattern:**\n1. Job A calls GenerateSilenceAsync(500ms) → creates `stitch_RANDOM1.wav`, caches it\n2. Job A's tempFiles list includes this silence path\n3. Job A finishes → finally block CLEANUP DELETES the silence file\n4. Job B calls GenerateSilenceAsync(500ms) → returns CACHED path that doesn't exist\n5. FFmpeg tries to find the file → ERROR \"Could not find file\"\n\n**Fix:** Silence files should NOT be added to tempFiles cleanup list since they're cached for reuse across jobs. They are cleaned separately in Dispose() via _silenceCache cleanup.\n\n**Code pattern to AVOID:**\n```csharp\nvar silencePath = await GenerateSilenceAsync(...);\ntempFiles.Add(silencePath); // BUG - will delete cached file!\n```\n\n**Code pattern to USE:**\n```csharp\nvar silencePath = await GenerateSilenceAsync(...);\n// Don't add to tempFiles - silence files are cached for reuse\nfilesToProcess.Add(silencePath);\n```","created_at":"2026-02-21T21:55:49.568Z","tags":"ffmpeg,bug,race-condition,temp-files,silence-cache,debugging"}
{"id":"mem-b4ffe72ba5a5adf4","information":"Flutter Riverpod Architecture Review Findings (Odeon):\n1. CRITICAL: ApiClientNotifier wraps mutable ApiClient - state changes don't trigger notifications\n2. HIGH: VideosNotifier Timer not disposed - memory leak\n3. HIGH: _GoRouterRefreshNotifier ProviderSubscription not disposed\n4. HIGH: Video URL auth - getVideoFileUrl lacks API key for media_kit requests\n5. MEDIUM: Duplicate _StatusChip widget in video_card and video_detail_screen\n6. MEDIUM: TextField suffixIcon doesn't rebuild dynamically in episodes_screen\n7. Silent failures in _pollDownloadProgress catch block\n8. GOOD: Folder structure is excellent - clear separation of concerns\n9. GOOD: StateNotifier pattern used consistently across providers\n10. GOOD: const usage is well-applied in widgets and state classes","created_at":"2026-02-17T03:13:35.946Z","tags":"flutter riverpod architecture review odeon frontend"}
{"id":"mem-ba993eee2cee2482","information":"Spectre.Console markup escaping: When using AnsiConsole.MarkupLine() or ctx.AddTask() with interpolated strings, dynamic text containing square brackets (e.g., \"[concat]\" from FFmpeg output) will be interpreted as markup tags, causing \"Could not find color or style 'concat'\" errors. Solution: Wrap ALL dynamic values with Markup.Escape() or manually replace \"[\" with \"[[\" and \"]\" with \"]]\". Key locations to check: task descriptions updated after creation, error messages, progress stages.","created_at":"2026-02-21T10:32:03.377Z","tags":"spectre-console,bug-fix,markup-escaping,csharp"}
{"id":"mem-bc6ffced1667413f","information":".NET yt-dlp download options implementation: Use DownloadOptionsDto with Quality enum (Best/P1080/P720/P480) and DownloadFormat enum (Video/AudioOnly). Build format strings dynamically: Best uses \"bv*[vcodec*=avc1]+ba[acodec*=mp4a]/bv*[vcodec*=avc1]+ba/b[ext=mp4]/bv*+ba/best\", quality-limited uses height constraints like \"bestvideo[height<=1080]+bestaudio/best[height<=1080]\". Audio-only uses \"-x --audio-format mp3 --audio-quality 0\" flags instead of format string. Store options as int in EF Core entity for compatibility with enum values.","created_at":"2026-02-20T19:51:14.632Z","tags":".NET,yt-dlp,download-options,quality-selection,format-selection"}
{"id":"mem-bda38a3a04aec3ae","information":"CharacterAnalyzer minimal orchestration pattern: ExtractDialogueText from scenes → CharacterExtractionPrompt.CreateUserPrompt → OllamaRequest with Temperature 0.3 → CharacterParser.Parse → List<Character>. Use IOllamaClient interface. CharacterParser has Parse method returning (List<Character>, List<string> errors) tuple.","created_at":"2026-02-20T01:05:06.804Z","tags":"csharp,ai,character-extraction,ollama,pipeline"}
{"id":"mem-c07313d742dcea21","information":"## Flutter Monorepo Build Errors - 2026-02-21\n\n### AppLogger Import Conflict (3 apps affected: bible_reading_app, confession_companion, novena_companion)\n\n**Root Cause:** Each app has its own `utils/logger.dart` that exports `AppLogger` class, AND they also depend on `sancta_via_shared_ui` which exports its own `AppLogger` from `package:sancta_via_shared_ui/src/utils/app_logger.dart`.\n\n**Error Pattern:**\n```\nlib/main.dart:51:7: Error: 'AppLogger' is imported from both 'package:bible_reading_app/utils/logger.dart' and 'package:sancta_via_shared_ui/src/utils/app_logger.dart'.\n```\n\n**Fix:** Either:\n1. Remove local `utils/logger.dart` from each app and use the shared one from `sancta_via_shared_ui`\n2. Or use explicit import prefixes to disambiguate\n\n### material_color_utilities Dependency Conflict (liturgical_calendar_app)\n\n**Root Cause:** The app has `material_color_utilities: ^0.11.1` in pubspec.yaml but Flutter SDK requires exactly `0.13.0`.\n\n**Error:**\n```\nBecause liturgical_calendar_app depends on flutter from sdk which depends on material_color_utilities 0.13.0, material_color_utilities 0.13.0 is required.\nSo, because liturgical_calendar_app depends on material_color_utilities ^0.11.1, version solving failed.\n```\n\n**Fix:** Run `flutter pub add material_color_utilities:^0.13.0` or remove the explicit dependency\n\n### Successful Build (prayer_companion)\nBuilt successfully - 57.1MB APK, 46.9MB AAB, 20.5MB iOS app","created_at":"2026-02-21T05:05:23.814Z","tags":"flutter,build-error,monorepo,import-conflict,dependency-conflict"}
{"id":"mem-c0b1201c6511514a","information":"Bun test patterns: Use `import { test, expect, describe, beforeEach, afterEach } from 'bun:test'`. For route testing with Hono, use `app.request('/path')` to get Response objects. Empty query parameters fall back to defaults, so test with invalid values rather than empty strings. Type assertions needed when using response.json() to avoid 'unknown' type errors.","created_at":"2026-02-20T20:50:48.188Z","tags":"bun,testing,typescript,hono,patterns"}
{"id":"mem-c0c28338148196ae","information":"Spectre.Console markup escaping: When using AnsiConsole.MarkupLine, ctx.AddTask, or task.Description with interpolated strings containing dynamic data (user input, FFmpeg output, error messages, file paths, chapter titles), ALWAYS wrap dynamic values with Markup.Escape() or use .Replace(\"[\", \"[[\").Replace(\"]\", \"]]\"). \n\nCommon patterns that need escaping:\n- task.Description = $\"[color]{dynamicVar}[/]\" → task.Description = $\"[color]{Markup.Escape(dynamicVar)}[/]\"\n- ctx.AddTask($\"[color]text: {dynamicVar}[/]\") → ctx.AddTask($\"[color]text: {Markup.Escape(dynamicVar)}[/]\")\n\nFFmpeg output often contains \"[filter_name]\" or \"[stream]\" patterns that Spectre.Console interprets as markup tags, causing \"Could not find color or style 'filter_name'\" errors.","created_at":"2026-02-21T10:23:44.950Z","tags":"csharp,spectre-console,markup,escape,bug-fix"}
{"id":"mem-c0c32a57563ac7ed","information":"ManuscriptMerger pattern for combining LLM-generated manuscript chunks: Use Dictionary<string, string> for ID remapping (old->new), Dictionary<string, string>(StringComparer.OrdinalIgnoreCase) for case-insensitive name deduplication. Character merging: first occurrence wins, but merge null properties from later occurrences. Scene/chapter IDs should be regenerated sequentially (char_001, scene_001, chapter_001 format). Dialogue SpeakerId references must be remapped using the character ID map.","created_at":"2026-02-20T08:25:46.717Z","tags":"c#,merger,chunking,manuscript,deduplication,id-remapping"}
{"id":"mem-c1abf3dcf0ec6280","information":"Hono app with Bun uses `export default { port, fetch: app.fetch }` pattern instead of Bun.serve(). Middleware is added via app.use('*', middleware()). Routes are mounted with app.route('/path', router). 404 handler via app.notFound(), errors via app.onError().","created_at":"2026-02-20T20:45:24.621Z","tags":"hono,bun,server,middleware,pattern"}
{"id":"mem-c1d9997d3d1b67cc","information":"Pagination bounds validation added to VideosController.cs to prevent DoS attacks. Added MaxPageSize constant (100) and clamp limit to [1, MaxPageSize] and offset to [0, int.Max]. Pattern: Math.Clamp(limit, 1, MaxPageSize) and Math.Max(0, offset) at start of controller method.","created_at":"2026-02-17T09:31:31.325Z","tags":"security,pagination,dos-prevention,validation"}
{"id":"mem-c22a615909673ae4","information":"Added data annotations to C# entity classes in Odeon project: Use System.ComponentModel.DataAnnotations namespace. [Required] for non-nullable properties, [StringLength(200)] for name fields, [Url] for URL properties. Place annotations on separate lines above properties for readability.","created_at":"2026-02-18T02:34:21.363Z","tags":"csharp,data-annotations,validation,entity-framework"}
{"id":"mem-c2b51cfad005cfef","information":"Flutter ApiClient refactoring: When migrating from mutable fields (_baseUrl, _apiKey) to immutable ApiConfig, ensure ALL references to the old fields are updated. Two methods commonly missed: _buildUri() and getVideoFileUrl() which may use the internal field directly.","created_at":"2026-02-17T04:06:02.193Z","tags":"flutter,refactoring,api-client,immutable"}
{"id":"mem-c43477b693ff92d2","information":"Skaldforge configuration pattern: Config classes in Skaldforge.Core/Configuration/{Name}Config.cs follow a simple POCO pattern with XML doc comments and default values. SkaldforgeConfig aggregates all configs. Tests in tests/Skaldforge.Tests/ConfigurationTests.cs verify defaults match expected values.","created_at":"2026-02-21T04:54:37.965Z","tags":"skaldforge,configuration,patterns,testing"}
{"id":"mem-cab19c01ad3a28fc","information":"ProseAnalysisPrompt class created for prose-to-Manuscript JSON conversion. Key patterns: (1) static string properties for SystemPrompt/JsonOutputFormat/ExampleOutput use raw string literals with triple quotes, (2) methods like CreateUserPrompt use StringBuilder pattern with $ interpolated strings and string concatenation, (3) validation methods use System.Text.Json.JsonDocument for parsing, (4) temperature 0.3 for deterministic extraction. JSON in interpolated strings causes CS9006 - use separate static properties instead.","created_at":"2026-02-20T03:21:15.338Z","tags":"csharp,prompt-templates,manuscript,json-schema,skaldforge"}
{"id":"mem-cb0e9d60b36392b4","information":"Skaldforge project enforces strict C# style rules: IDE0011 requires braces for ALL if/else statements (no single-line if statements). Kokoro TTS API base URL is configured via TtsConfig.BaseUrl (default: http://kokoro.lan/). Voice naming convention: {lang}{gender}_name (e.g., af_heart=American Female, bm_george=British Male). Sample rate is 24000Hz. The KokoroClient.cs implements IDisposable and wraps HttpClient with proper error handling.","created_at":"2026-02-21T05:01:53.767Z","tags":"skaldforge kokoro tts csharp style-rules httpclient"}
{"id":"mem-ce507df9a899fea2","information":"Harmony 2.0 .NET Modernization Audit: Identified 3 critical bugs - Thread.Sleep(600) should be 5 minutes, malformed FFprobe command always returns true, and null dereference in GenerateCover. Codebase is well-structured but needs bug fixes before production. Newtonsoft.Json should be kept for AudibleVoucherDto due to JsonConvert consumer usage. Key patterns: System.Text.Json migration done for most DTOs, nullable reference types enabled, pattern matching (is null/is not null) used throughout.","created_at":"2026-02-21T22:50:00.653Z","tags":"dotnet audit harmony bugs modernization newtonsoft system.text.json"}
{"id":"mem-cee77e222a024304","information":"AAXtoM4BConvertor.cs modernization: Safe auto-fixes applied include: string interpolation ($\"\"), pattern matching (is not null instead of != null), var instead of explicit types for locals, string.Empty constant, null-coalescing for Path.GetDirectoryName. The file uses Xabe.FFmpeg library with .Wait() pattern for async operations - this is intentional for console apps. Multiple nullable reference warnings remain in AddMetadataToM4A method where aaxInfo?.format?.tags chain is dereferenced - these require careful null checks or guard clauses and should be reviewed manually.","created_at":"2026-02-21T22:44:46.828Z","tags":"csharp,modernization,nullable-reference-types,ffmpeg,audit"}
{"id":"mem-d0ae4f50cc35eed4","information":"AWESOMEASSERTIONS NAMESPACE GOTCHA: AwesomeAssertions package v8.0 maintains FluentAssertions API compatibility. The namespace is still `FluentAssertions`, NOT `AwesomeAssertions`. When migrating from FluentAssertions to AwesomeAssertions, keep `using FluentAssertions;` - only change the PackageReference name and version in Central Package Management.\n\n.NET TEST PROJECT SETUP: For NUnit + AwesomeAssertions setup:\n1. Packages needed: NUnit, NUnit3TestAdapter, NUnit.Analyzers, AwesomeAssertions, Microsoft.NET.Test.Sdk, coverlet.collector\n2. Using statements: `NUnit.Framework` and `FluentAssertions` (not AwesomeAssertions!)\n3. Use [Test] attribute (NUnit) not [Fact] (xUnit)\n4. For Central Package Management, define PackageVersion items matching PackageReference names","created_at":"2026-02-19T19:34:04.690Z","tags":".NET,NUnit,AwesomeAssertions,testing,gotcha,namespace"}
{"id":"mem-d29a29f9f8a33031","information":"AudioPipeline orchestrator pattern for Manuscript → Audio conversion:\n- Uses ITtsEngine for synthesis and optional IVoiceMapper for AI voice assignment\n- Supports both pre-configured voice assignments (manual) and AI-assisted mapping\n- Implements IProgress<T> for progress reporting during long-running synthesis\n- Handles cancellation via CancellationToken\n- Splits long narration into chunks (500 chars) for better TTS synthesis\n- Creates chapter subdirectories for organized output\n- Tracks segments with full metadata (chapter, scene, character, line index)\n- Supports partial success via ContinueOnError option\n- Naming pattern supports {chapter}, {scene}, {type}, {index} placeholders","created_at":"2026-02-21T05:26:17.339Z","tags":"audio,pipeline,tts,synthesis,orchestration,progress-reporting,cancellation"}
{"id":"mem-d4f9975f5b0aeaf7","information":"FFmpeg concat demuxer \"Line 1: string required\" error debugging:\n1. Check for empty filesToConcat list before writing concat file\n2. Skip null/empty paths in WriteConcatFileAsync\n3. Add debug Console.WriteLine to show file count, paths, and actual concat content\n4. Use Encoding.UTF8 explicitly for WriteAllTextAsync to avoid BOM issues\n5. Validate file paths exist before writing to concat file (log warning if not)\n6. The error \"Line 1: string required\" usually means the concat file is empty or has invalid content on the first line - add validation to throw InvalidOperationException with helpful message when no valid files to process.","created_at":"2026-02-21T10:49:31.011Z","tags":"ffmpeg,concat,debug,error-handling"}
{"id":"mem-d5548d16ecdfa84e","information":"BibleVerse.toString() was crashing on empty text because substring(0, 0) on empty string still causes issues. Fixed by adding `text.isEmpty ? '' :` guard before the substring call. Always check for empty strings before using substring operations in Dart.","created_at":"2026-02-20T04:33:38.955Z","tags":"bug-fix,dart,substring,empty-string,bible-data"}
{"id":"mem-d5e35d3c2dc6ae09","information":".NET 10 includes System.Text.Json as a built-in library. When upgrading from net9.0 to net10.0, explicit PackageReference to System.Text.Json becomes unnecessary and triggers NU1510 warning. If TreatWarningsAsErrors is enabled, this will fail the build. Solution: remove the explicit System.Text.Json package reference from .csproj files when targeting .NET 10+.","created_at":"2026-02-19T22:00:23.533Z","tags":"dotnet,net10.0,upgrade,System.Text.Json,NU1510"}
{"id":"mem-d6bd6a83a0a97fa3","information":"Kokoro TTS API voices endpoint returns `{\"voices\": [\"af_heart\", \"am_adam\", ...]}` - an array of voice ID strings, NOT objects. The GetVoicesAsync method must deserialize to a `KokoroVoicesResponse` wrapper class with `voices` property, then transform the string IDs into `KokoroVoice` objects by parsing the voice ID naming convention (e.g., \"af_heart\" = American Female).","created_at":"2026-02-21T06:55:53.510Z","tags":"kokoro,tts,api,json,response-parsing"}
{"id":"mem-d742a719237108a5","information":"VoiceMapper test patterns: \n1. NSubstitute for mocking IOllamaClient works well with Arg.Do for capturing requests and Returns for responses\n2. For fallback testing, use Task.FromException<OllamaResponse>(new OllamaException(...))\n3. Voice ID format is {lang}{gender}_name where lang=(a=American, b=British, f=French, h=Hindi, i=Italian, j=Japanese, p=Portuguese, z=Chinese), gender=(m=male, f=female)\n4. Score formula: 0.5 base + 0.3 gender match + 0.2 language match + 0.05 warm voice name (heart, emma, sarah, sparkle, nova, blaze, serene, peace, calm)\n5. Confidence is capped at 1.0, so avoid tests that expect values > 1.0\n6. The VoiceMapper stores assignments in ConcurrentDictionary - manuscript IDs are case-sensitive, but character IDs within a manuscript are case-insensitive","created_at":"2026-02-21T05:46:50.155Z","tags":"testing,voicemapper,nsubstitute,patterns,c#"}
{"id":"mem-d7be63630a08b7a2","information":"**KokoroVoiceMapper Implementation Pattern**\n\nWhen implementing VoiceMapper for Kokoro TTS voice selection:\n1. Voice ID format: `{lang}{gender}_name` (e.g., `af_heart` = American Female)\n2. Language codes: a=American, b=British, f=French, h=Hindi, i=Italian, j=Japanese, p=Portuguese, z=Chinese\n3. Gender codes: m=male, f=female\n4. IVoiceMapper interface from Skaldforge.Core.Interfaces requires: SuggestVoicesAsync, AssignVoiceAsync, GetAssignmentsAsync, BatchAssignAsync, PreviewVoiceAsync\n5. VoiceMappingPrompt uses temperature 0.4 for creative matching (vs 0.3 for extraction)\n6. Fallback voice scoring: 0.5 base + 0.3 gender match + 0.2 language match\n7. CharacterProfile has Analysis with VocalGender, VocalAge, AccentHints for voice matching\n8. VoiceSuggestion has required VoiceId property - must use object initializer","created_at":"2026-02-21T05:16:35.139Z","tags":"kokoro,voice-mapping,ai-services,patterns"}
{"id":"mem-d7e8021aa210b5eb","information":"When testing file persistence in TTS engines, verify: 1) Directory creation is lazy (not in constructor), 2) Files are written with correct names ({segmentId}.{format}), 3) AudioUrl contains actual file path not placeholder URLs, 4) File contents match audio bytes. Use [SetUp] to create temp directory with Guid in name for isolation, [TearDown] to clean up.","created_at":"2026-02-21T06:42:13.755Z","tags":"testing,audio-persistence,temp-directory,unit-tests"}
{"id":"mem-d83eaa7969dcf65a","information":"Flutter URL validation with SSRF protection: Use Uri.tryParse() for parsing, check scheme (http/https), validate host is non-empty, and block private IP ranges (127.0.0.0/8 localhost, 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 0.0.0.0, ::1 IPv6 localhost, 'localhost' hostname). Create a UrlValidationResult class for clean return values. The 172.16-31.x.x range check is tricky: check if first octet is 172 AND second is between 16-31 inclusive.","created_at":"2026-02-18T00:17:49.316Z","tags":"flutter,url-validation,ssrf,security,dart"}
{"id":"mem-dcdc472e0cd797d9","information":"NSubstitute can only mock virtual methods on classes. When testing a class that depends on another concrete class (not an interface), the dependent class methods must be marked as virtual to allow NSubstitute to intercept and mock them. For KokoroClient, I had to make SynthesizeAsync, GetVoicesAsync, IsHealthyAsync, and Dispose virtual to enable proper mocking in tests.","created_at":"2026-02-21T05:37:14.999Z","tags":"testing,nsubstitute,mocking,dotnet,csharp"}
{"id":"mem-dd7b37c392cc146e","information":"StoryParser implementation in Skaldforge.Core uses System.Text.Json with snake_case naming policy (JsonNamingPolicy.SnakeCaseLower). The ValidationResult, ValidationError, ValidationWarning, and ManuscriptStatistics classes are defined in IStoryParser.cs. Domain models use required properties with snake_case JSON property names via JsonPropertyNameAttribute. Schema validation performed manually since no JSON schema library is in dependencies - validates required fields, ID patterns (chapter_xxx, char_xxx, scene_xxx), enum values, and reference integrity between chapters/scenes and dialogue/characters.","created_at":"2026-02-19T20:02:06.235Z","tags":"skaldforge,json-parsing,validation,system.text.json,.net"}
{"id":"mem-de92902ca6a4bc96","information":"PagedResult refactoring: Changed from non-generic PagedResult class (Odeon.Core.Interfaces) to generic PagedResult<T> class (Odeon.Core.DTOs). When updating tests:\n1. Add `using Odeon.Core.DTOs;` import\n2. Change all `new PagedResult()` to `new PagedResult<Video>()`\n3. Update method return type assertions from `Task<PagedResult>` to `Task<PagedResult<Video>>`\n4. The generic version has additional properties: PageNumber, TotalPages, HasPreviousPage, HasNextPage, and static methods Empty() and Create()","created_at":"2026-02-17T08:59:53.338Z","tags":"csharp,testing,pagedresult,refactoring"}
{"id":"mem-df15278b4626cace","information":"Watch history tracking implementation pattern in Odeon .NET backend: \n1. Entity with Guid Id, foreign key reference, navigation property using null! for nullable reference types\n2. ApplicationDbContext adds DbSet and configures entity with OnDelete(DeleteBehavior.Cascade)\n3. Interface in Odeon.Core/Interfaces with async methods and XML docs\n4. Service implementation uses scoped lifetime (DbContext), includes logging, structured error handling\n5. Controller uses ApiController attribute, rate limiting, XML doc comments\n6. DTOs are records in Odeon.Api/DTOs\n7. Register service as Scoped in Program.cs after other services","created_at":"2026-02-20T19:45:33.936Z","tags":".NET,EF Core,entity,pattern,Odeon"}
{"id":"mem-e2f4e3b57572604d","information":"Hono API routes pattern for TypeScript:\n- Import Hono from 'hono' and create router with `new Hono()`\n- Use router.get('/path', async (c) => { ... }) for route handlers\n- Access query params with `c.req.query('param')` and path params with `c.req.param('name')`\n- Return JSON with `c.json(data, status?)`\n- Export router as default\n\nError response pattern:\n- Create typed ErrorResponse objects with error code, message, and status\n- Return with appropriate HTTP status codes (400 for validation, 404 for not found, 500 for server errors)\n\nRe-export pattern:\n- Create index.ts that re-exports all routers for clean imports","created_at":"2026-02-20T20:43:53.735Z","tags":"hono,typescript,api-routes,error-handling"}
{"id":"mem-e7d4aded9ed5eb9a","information":"Silence cache race condition: When caching generated silence files for reuse, NEVER add them to the tempFiles cleanup list. The race condition flow: Job A creates silence, caches it, adds to tempFiles, finishes and deletes all tempFiles including the cached silence. Job B requests same silence duration, gets stale cached path that no longer exists. Fix: Silence files are managed by _silenceCache and cleaned in Dispose(), not in job-scoped tempFiles cleanup.","created_at":"2026-02-21T22:00:27.334Z","tags":"ffmpeg,race-condition,temp-files,caching,bug-fix"}
{"id":"mem-e9bf7f0771b1338c","information":"Parallelized batch video info fetching in YtDlpService.GetChannelVideosAsync using IConcurrencyManager.DownloadSemaphore. The key pattern is:\n1. Inject IConcurrencyManager into YtDlpService constructor\n2. Use await _concurrencyManager.DownloadSemaphore.WaitAsync() before fetching each video\n3. Wrap in try/finally with semaphore.Release() to ensure proper cleanup\n4. This throttles parallel fetching to respect MaxConcurrentDownloads limit\n\nThe semaphore ensures that even when processing batches of videos in parallel, the total concurrent yt-dlp calls are limited to prevent rate limiting and resource exhaustion.","created_at":"2026-02-17T23:24:57.903Z","tags":"parallel,semaphore,throttling,yt-dlp,batch-processing,concurrency"}
{"id":"mem-eb2cec88bc7cf944","information":"Silence cache race condition fix verified: Silence files created by GenerateSilenceAsync are no longer added to tempFiles cleanup list. This prevents files from being deleted while cached for reuse across jobs. The fix was confirmed working - cleanup only removes concat artifacts, not silence cache files.","created_at":"2026-02-21T21:59:42.964Z","tags":"stitching,silence-cache,race-condition,fix-verified"}
{"id":"mem-ec6326a2dc3e065d","information":"GitHub repository initialization pattern for new projects: 1) git init, 2) Create .gitignore (node_modules, dist, .env, logs, IDE files, coverage), 3) Create LICENSE with Apache 2.0 text (full license text required), 4) Create README.md with project name, description, badge placeholders, installation/usage sections, 5) git add .gitignore LICENSE README.md, 6) git commit -m \"Initial commit: project scaffold\", 7) gh repo create <name> --public --source=. --push. This creates a clean scaffold without code files for separate workers to implement.","created_at":"2026-02-20T20:02:17.195Z","tags":"github,git,initialization,setup,apache-2.0,scaffold,bun,node"}
{"id":"mem-ee3d3e5f27b86459","information":"Odeon Backend Security Review: Strong command injection prevention using SecurityHelper.EscapeShellArgument() with null byte removal, newline rejection, and proper quoting. BCrypt with work factor 12 for API key storage. EF Core prevents SQL injection. HTTPS enforced. Rate limiting implemented. Areas for improvement: DTO validation attributes missing, API key logged on startup, video file endpoints bypass auth (documented design decision). No critical vulnerabilities found.","created_at":"2026-02-17T03:04:30.751Z","tags":"security,command-injection,api-authentication,owasp,odeon,backend"}
{"id":"mem-eee33abc1a2ec634","information":"Skaldforge Project Assessment: The project is ~27% complete with Milestone 1 at 60%. Key blockers: no CI/CD, no CLI implementation, no parser implementation. Critical path: CI/CD -> StoryParser -> CLI Commands -> Unit Tests. Placeholder projects (Skaldforge.Tts, Skaldforge.Ai, Skaldforge.Audio) contain only Class1.cs stubs. Exception handling partially exists (only ManuscriptParseException). Note: .NET 8 currently, planned upgrade to .NET 9 recommended after Milestone 1.","created_at":"2026-02-19T21:18:19.222Z","tags":"skaldforge,assessment,project-status,.net,blockers"}
{"id":"mem-ef58b3761fee06ed","information":".NET framework migration: When upgrading .NET projects, check the installed runtime version on the target system. The system had .NET 10 installed but not .NET 9 runtime, so we upgraded directly to net10.0 instead of net9.0. This saved significant debugging time compared to installing a separate runtime. Also: System.Text.Json is built into .NET 10, so explicit package references can be removed to avoid NU1510 warnings.","created_at":"2026-02-19T22:09:08.533Z","tags":"dotnet,migration,runtime-version,skaldforge"}
{"id":"mem-f388cfa19ef90349","information":"Removed output.json default loading behavior from TestRunner. The LoadManuscriptAsync method now only: (1) loads from command-line argument if provided, or (2) falls back to built-in test manuscript. This ensures explicit file specification by users.","created_at":"2026-02-21T07:14:29.374Z","tags":"testrunner,manuscript-loading,behavior-change"}
{"id":"mem-f59180b71c74b7d1","information":"Flutter Security Best Practices: 1) Always enforce HTTPS for API endpoints, warn on HTTP URLs. 2) Never store API keys in SharedPreferences - use FlutterSecureStorage only. 3) Background services in Flutter cannot access FlutterSecureStorage directly - use encrypted IPC or secure arguments. 4) Always cancel Timer and StreamSubscription in StateNotifier dispose(). 5) Validate and sanitize all URLs before API calls. 6) Use Uri.encodeComponent for URL path segments. 7) Always use try-finally for resource cleanup (HttpClient, etc).","created_at":"2026-02-17T03:16:05.870Z","tags":"flutter,security,async,dispose,api-key,https"}
{"id":"mem-f6e852c5d3fb3fed","information":"Flutter immutable model pattern: Use @immutable annotation from flutter/foundation.dart, const constructor with default values, copyWith with clearApiKey pattern for nullable fields, and Object.hash for hashCode. Test with flutter_test expecting 17+ test cases for robust coverage.","created_at":"2026-02-17T03:30:18.536Z","tags":"flutter,immutable,model,copyWith,testing"}
{"id":"mem-f8ac906a55eb63d6","information":"When creating LLM prompt templates for structured JSON extraction in C#, use static classes with string properties for system prompts and factory methods for user prompts. Include: (1) System prompt with role definition and rules, (2) JSON output format specification with examples, (3) User prompt factory methods that accept both text and optional hints, (4) A JSON structure validator. Use temperature 0.3 for deterministic output. Always tell LLM to output ONLY valid JSON with no markdown code blocks.","created_at":"2026-02-20T00:31:50.679Z","tags":"prompt-engineering,llm,json-extraction,csharp,skaldforge"}
{"id":"mem-fdc38f3db60ab635","information":"FFmpeg Audio Stitching Implementation Patterns:\n1. Use concat demuxer with file list for combining audio segments - more reliable than filter_complex concat\n2. Two-pass loudnorm requires JSON parsing; single-pass is simpler and still EBU R128 compliant\n3. Silence generation uses lavfi anullsrc - cache silence files for reuse to avoid regeneration\n4. Acrossfade filter syntax: `acrossfade=d={seconds}:c1=tri:c2=tri` with triangle curves\n5. For M4B/Mp3 chapter marks, use FFMETADATA file format with TIMEBASE=1/1000\n6. Always use StringComparison.Ordinal for StartsWith calls to avoid CA1310 warnings\n7. FFmpegWrapper uses Xabe.FFmpeg library which handles process execution and progress reporting","created_at":"2026-02-21T07:30:55.724Z","tags":"ffmpeg,audio-processing,csharp,stitching,loudnorm,crossfade"}
{"id":"mem-fff101241e8c47d3","information":"FlutterSecureStorage migration for Odeon: AuthService already uses FlutterSecureStorage for credentials. The security issue was in background_polling_service.dart which used SharedPreferences for api_key and server_url. Fixed by updating callbackDispatcher to use FlutterSecureStorage.read() for credentials while keeping SharedPreferences for non-sensitive settings (notifications_enabled, last_check_time). Both storages have different use cases: FlutterSecureStorage for sensitive data (credentials), SharedPreferences for non-sensitive preferences.","created_at":"2026-02-18T00:27:05.213Z","tags":"flutter,security,flutter_secure_storage,shared_preferences,background_task,credentials"}